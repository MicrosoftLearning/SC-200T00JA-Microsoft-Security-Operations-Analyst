# モジュール 7 - ラボ 1 - 演習 2 - プレイブックを作成する

### タスク 1: Microsoft Teamsでセキュリティ オペレーションセンター チームを作成します。

このタスクでは、このラボ用のMicrosoft Teamsを作成します。

1. 管理者として WIN1 仮想マシンにログインします。パスワードは**Pa55w.rd** です。  

2. Microsoft Edgeブラウザーで、新しいタグを開き、Microsoft Teams ポータル (https://teams.microsoft.com) に移動します。

3. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントのメール** アカウントをコピーして貼り付け、「**次へ**」を選択します。

4. 「**パスワードの入力**」 ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントのパスワード**をコピーして貼り付け、「**サインイン**」 を選択します。

5. 表示される可能性のある Teams ポップアップをすべて閉じます。

6. まだ選択されていない場合は、左側のメニューで、「**Teams**」を選択し、下部にある「**参加または Team の作成**」を選択します。

7. メイン ウィンドウで 「**チームの作成**」 ボタンを選択します。

8. 「**最初から**」 ボタンを選択します。

9. 「**プライベート**」ボタンを選択します。

10. チームに**SOC** と名前を付け、「**作成**」 ボタンを選択します。

11. 「SOC にメンバーを追加」画面で、「**スキップ**」 ボタンを選択します。 

12. 新しく作成された SOC チームの横にある **「...」** を選択し、「**チャネルの追加**」を選択します。

13. *新しいアラート*のチャネル名を入力し、「**追加**」ボタンを選択します。

### タスク 2: Azure Sentinel でプレイブックを作成する

このタスクでは、AzureSentinelでプレイブックとして使用されるロジックアプリを作成します。

1. Microsoft Edge ブラウザーで Azure portal (https://portal.azure.com) に移動します。

2. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントのメール** アカウントをコピーして貼り付け、「**次へ**」を選択します。

3. **パスワードの入力**ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントパスワード** をコピーして貼り付け、「**サインイン**」を選択します。

4. Azure portal の検索バーに「*Sentinel*」と入力してから、「**Azure Sentinel**」を選択します。

5. 先ほど作成した Azure Sentinel ワークスペースを選択します。

6. ページの左側にある*コンテンツ管理*領域で、「**コミュニティ**」ページを選択します。

7. 右側のペインで、「**Onboard community content**」 (コミュニティ コンテンツのオンボード) リンクを選択します。これにより、Azure Sentinel GitHub コンテンツに対する新しいタブが Microsoft Edge ブラウザーで開きます。

8. 「**プレイブック**」フォルダーを選択します。

9. 「**Post-Message-Teams**」フォルダーを選択します。

10. readme.md ボックスで、2 番目の*クイック デプロイ* オプションである「**Deploy with alert trigger**」 (アラート トリガーを使用してデプロイ) の下に移動し、「**Deploy to Azure**」 (Azure にデプロイ) ボタンを選択します。  

**非常に重要**: これらは、インシデントとアラートを使用するための 2 つの異なる Azure Sentinel トリガーであることに注意してください。2 番目のアラートを選択していることを確認してください。

11. Azure サブスクリプションが選択されていることを確認してください。

12. リソース グループで、「**新規作成**」を選択し、「*RG-Playbooks*」と入力して、「**OK**」選択します。

13. 領域については、状況に適した領域を選択してください。既定の領域が最適になる可能性があります。

14. *プレイブック名*が "PostMessageTeams-OnAlert" であることを確認して、「**確認および作成**」を選択します。

15. ここで「**作成**」を選択します。

**注**次のタスクに進む前に、デプロイが完了するまで待機します。デプロイには数分かかる場合があります。

### タスク 3: Azure Sentinel でプレイブックをアップデートする

このタスクでは、作成した新しいプレイブックを適切な接続情報で更新します。

1. Azure portal の検索バーに「*Sentinel*」と入力してから、「**Azure Sentinel**」を選択します。

2. Azure Sentinel ワークスペースを選択します。

3. 構成領域から「**自動化**」を選択してから、「**アクティブなプレイブック**」タブを選択します。

4. **PostMessageTeams-OnAlert** プレイブックを選択します。

5. *PostMessageTeams-OnAlert* の LogicApp ページで、「**編集**」を選択します。

6. 「**Azure Sentinel アラートへの対応がトリガーされたとき**」ブロックを選択します。

7. 「**接続の変更**」リンクを選択します。

8. 「**新規追加**」を選択し、「**サインイン**」を選択します。新しいウィンドウで、プロンプトが表示されたら、Azure サブスクリプション管理者の資格情報を使用してサインインします。

9. 次に、「**アラート - インシデントの取得**」ブロックを選択します。

10. 「**接続の変更**」リンクを選択します。

11. 「*表示名*」で Azure サブスクリプション管理者の資格情報を持つ接続を選択します。**ヒント:** admin@ZZZZZZ.onmicrosoft.com.

12. 次に、「**接続**」ブロックを選択します。

13. 「**新規追加**」を選択し、プロンプトが表示されたら、Azure サブスクリプション管理者の資格情報を選択します。

14. 次に、「**メッセージの投稿 (V3)**」ブロックの Team ボックスの最後にある「**X**」を選択して、内容を消去します。編集ボックスは、Microsoft Teams から利用可能なチームのリストを含むドロップダウンに変更されます。  「**SOC**」を選択します。

15. チャンネルにも同様の操作を行い、編集ボックスの最後にある「**X**」を選択して、内容を消去します。編集ボックスは、チームのリストを含むドロップダウンに変更されます。「**新しいアラート**」を選択します。

16. コマンド バーの「**保存**」を選択します。

これらはのちのラボで使用します。

## 演習 3 に進みます。
