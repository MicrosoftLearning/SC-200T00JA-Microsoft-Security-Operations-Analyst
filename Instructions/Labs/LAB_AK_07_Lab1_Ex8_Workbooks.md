# モジュール 7 - ラボ 1 - 演習 8 - ワークブックの作成

## ラボ シナリオ

あなたは Azure Sentinel を実装済みの会社で働いているセキュリティ オペレーションアナリストです。高度な視覚化を使用してワークブックを設計する必要があります。

### タスク 1: ワークブックを調べる

このタスクでは、ブックの構成について説明します。

1. 管理者として WIN1 仮想マシンにログインします。パスワードは**Pa55w.rd** です。  

2. Microsoft Edge ブラウザーで Azure portal (https://portal.azure.com) に移動します。

3. **サインイン** ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントのメール** アカウントをコピーして貼り付け、「**次へ**」を選択します。

4. **パスワードの入力**ダイアログ ボックスで、ラボ ホスティング プロバイダーから提供された**テナントパスワード** をコピーして貼り付け、「**サインイン**」を選択します。

5. Azure portal の検索バーに「*Sentinel*」と入力してから、「**Azure Sentinel**」を選択します。

6. Azure Sentinel ワークスペースを選択します。

7. 「**ワークブック** 」を選択します。

8. 「**ID とアクセス**」を選択し、「**テンプレートの表示**」ボタンを選択します。

9. 「ID とアクセス」ワークブックを確認します。

10. 右上隅の「x」を選択して、ワークブックを閉じます。**Azure Sentinel** に移動するはずです **| ワークブック | テンプレート** タブ。

11. *テンプレート* タブで「**Azure AD 監査ログ**」を検索して選択してから、右側ペインから「**保存**」ボタンを選択します。 

12. 場所に適切な場所を選択して、「**OK**」を選択します。適切な場所は通常、既定です。

13. 「**保存されたワークブックの表示**」ボタンを選択します。

14. コマンドバーの「**編集**」を選択します。

15. *ユーザー アクティビティ*領域で、"操作数" と "傾向" のグラフの色を確認してください。次に、以下のグリッドの「**編集**」を選択します。

#### 列をフォーマットするには、列設定パネルにカスタマイズオプションがあるので、次のようにします。

16. クエリ コマンド バーの右側にある「**列設定**」ボタンを選択します。

**注:** このボタンは、レポート内にデータがある場合にのみ表示されます。

17. *列の設定の編集*ブレードで、**Operations Count (Heatmap + Formatted)** 列を選択します。

18. 設定、特に*列レンダラー*のオプションを確認します。*カラー パレット*については、「**32 -color categorical**」 (32 色のカテゴリ別) を選択します。

19. 列 **Trend (Spark line + Formatted)** を選択します。

20. 設定を確認し、*列レンダラー*については、「**Spark 領域**」を選択し、*カラー パレット*で選択した色を選択します。

21. 「**保存して閉じる**」を選択します。

#### あるタイル/グリッドのコントロールが、別のタイル/グリッドの結果をフィルタリングするには、次のようにします。

22. *クエリ アイテムの編集: クエリ - 2*.で、「**詳細設定**」ボタンを選択します。

23. 「*アイテムを選択したら、パラメーターをエクスポートする*」設定を確認します。*UserInfo* フィールドが選択されていることに注意してください。

24. クエリの下部にある「**編集完了**」を選択します。

25. 画面の右側にある「*上位アクティブ ユーザー*」グリッドの下の「**編集**」を選択します。  

26. クエリの中で「*UserInfo*」を探します。このクエリは、他のクエリからエクスポートされたパラメータを使用して結果をフィルタリングしています。

27. クエリの下部にある「**編集完了**」を選択します。

28. ワークブックについては、上部メニューで、「**編集の完了**」を選択し、「**保存**」アイコンを選択します。右上隅の「x」を選択して、ワークブックを閉じます。

### タスク 2: ワークブックを作成します。

このタスクでは、高度な視覚化を備えた新しいワークブックを作成します。

1. Azure Sentinel ポータルの「**ワークブック**」領域に戻ります。

2. 「**+ ワークブックの追加**」を選択します

3. 「**編集**」を選択します

#### ヘッダーテキストを編集します:

4. ワークブックのタイトルの下の「**編集**」を選択し、*## 新しいワークブック* を *## マイ ワークブック*に変更します。

5. ヘッダー テキストに対して、「**編集完了**」を選択します。

6. 表示される唯一のグラの下で、「**編集**」を選択します。

7. 複数のテーブルにわたるカウントの和集合を提供するKQLステートメントを確認してください。

8. グラフに対して、「**編集完了**」を選択します。

9. グラフ領域の横の **「...」** を選択し、「**+ 追加**」を選択し、「**クエリを追加**」を選択します。

10. クエリ ボックスに「*SecurityEvent*」と入力し、「**クエリの実行**」ボタンを選択します。

11. *時間の範囲*を「**過去 3 日間**」に変更します。

12. *視覚化*を「**棒グラフ**」に変更して、結果を確認します。

13. *視覚化*を「**時間グラフ**」に変更して、結果を確認します。

14. クエリタブの「**スタイル**」を選択します。

15. 「**Make this item a custom width**」ボックスを選択します。

16. パーセント幅 を「**75**」に、最大幅を「**75**」に設定します。

17. クエリタブの「**高度な設定**」を選択します。

18. 「**編集していないときに更新アイコンを表示する**」ボックスを選択します。 

19. 新しいグラフに対して、「**編集完了**」を選択します。

20. ワークブックの下部で、「**追加**」を選択してから、「**クエリの追加**」を選択します。

クエリに対して次の KQ Lコマンドを入力します。

```
SecurityEvent
```

21. 「時間の範囲」で、「**過去 4 時間**」を選択します。

22. 視覚化を「**グリッド**」に変更します。

23. 「**スタイル**」タブを選択します。

24. 「**Make this item a custom width**」を選択します。

25. パーセント幅を「**25**」、最大幅を「**25**」に変更します。 

26. 新しいクエリに対して、「**編集完了**」を選択します。

27. ワークブックの「**編集完了**」を選択します。

28. 「**保存**」アイコンを選択し、*タイトル*を*マイ ワークブック*に変更し、「**保存**」を再度選択します。

29. 右上の「x」を選択して、ワークブックを閉じるか、Azure Sentinel ポータルで、「**ワークブック**」を選択します。

30. 必要に応じて、「**マイ ワークブック**」タブを選択します。

31. 作成したワークブックを選択します。

32. 「**保存されたワークブックの表示**」を選択します。

## これでラボは完了です。
